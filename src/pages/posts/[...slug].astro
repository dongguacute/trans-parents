---
import Layout from '../../layouts/Layout.astro';
import Navigation from '../../components/Navigation.astro';
import Alert from '../../components/Alert.astro';
import ExpandableContent from '../../components/ExpandableContent.astro';

// üîß ‰øÆÊ≠£ 1ÔºöAstro.glob ‰ΩøÁî®Áõ∏Â∞çÊñºÈ†ÖÁõÆÊ†πÁõÆÈåÑÁöÑË∑ØÂæëÔºå‰∏¶Ê∑ªÂä†È°ûÂûãË®ªËß£
export async function getStaticPaths() {
  const posts: any[] = await Astro.glob('../../posts/*.md');
  return posts.map((post: any) => {
    const slug = post.file.split('/').pop()?.replace('.md', '');
    if (!slug) {
      throw new Error(`Invalid slug for post: ${post.file}`);
    }
    return {
      params: { slug },
      props: { post },
    };
  });
}

// ÂèñÂæóÂÇ≥ÂÖ•ÁöÑÊñáÁ´†ÂÖßÂÆπ
const { post } = Astro.props;

// Ê≠£Á¢∫ÁöÑ Astro ÂÖßÂÆπËôïÁêÜÊñπÂºè
const Content = post.Content;

// ‰øÆÊ≠£Â≠óÊï∏Ë®àÁÆóÈÇèËºØÔºåËôïÁêÜ‰∏≠Ëã±ÊñáÂ≠óÁ¨¶
const rawContentString = post.body || '';
const wordCount = rawContentString ?
  rawContentString
    .replace(/\s+/g, '') // ÁßªÈô§Á©∫ÁôΩÂ≠óÁ¨¶
    .length : 0;
const readingTime = Math.ceil(wordCount / 200); // ÂÅáË®≠ÊØèÂàÜÈêòÈñ±ËÆÄ 200 Â≠ó

// Êó•ÊúüÊ†ºÂºèÂåñÔºåÊ∑ªÂä†È°ûÂûãË®ªËß£
const formatDate = (dateString: string) => {
  const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'long', day: 'numeric' };
  return new Date(dateString).toLocaleDateString('zh-TW', options);
};
---

<Layout title={post.frontmatter.title}>
  <Navigation />
  <div class="article-container">
    <article class="article-content">
      <div class="article-header">
        <div class="article-meta-top">
          <span class="meta-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 8V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V8C3 7.46957 3.21071 6.96086 3.58579 6.58579C3.96086 6.21071 4.46957 6 5 6H19C19.5304 6 20.0391 6.21071 20.4142 6.58579C20.7893 6.96086 21 7.46957 21 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>{wordCount} Â≠ó</span>
          </span>
          <span class="meta-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 8V12L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>{readingTime} ÂàÜÈêòÈñ±ËÆÄ</span>
          </span>
        </div>
        <h1 class="article-title">{post.frontmatter.title}</h1>
        <div class="article-meta-bottom">
          <span class="meta-item">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M16 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 8V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V8C3 7.46957 3.21071 6.96086 3.58579 6.58579C3.96086 6.21071 4.46957 6 5 6H19C19.5304 6 20.0391 6.21071 20.4142 6.58579C20.7893 6.96086 21 7.46957 21 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <time>{formatDate(post.frontmatter.date)}</time>
          </span>
          {post.frontmatter.category && (
            <span class="meta-item category">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>{post.frontmatter.category}</span>
            </span>
          )}
          {post.frontmatter.tags && post.frontmatter.tags.map((tag: string) => (
            <span class="meta-item tag">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7 7L17 17M17 7L7 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span>{tag}</span>
            </span>
          ))}
        </div>
      </div>
      <div class="markdown-content">
        <Content />
      </div>
    </article>
  </div>
</Layout>

<style>
  .article-container {
    padding: 1rem;
    padding-top: 5rem;
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    color: var(--color-text);
  }

  .article-content {
    background: var(--color-card);
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 4px 20px var(--color-shadow);
  }

  .article-header {
    margin-bottom: 2rem;
    border-bottom: 1px dashed var(--color-border);
    padding-bottom: 1.5rem;
  }

  .article-meta-top {
    display: flex;
    gap: 1.5rem;
    margin-bottom: 1rem;
    font-size: 0.9rem;
    color: var(--color-text-secondary);
  }

  .article-meta-top .meta-item {
    display: flex;
    align-items: center;
    gap: 0.3rem;
  }

  .article-meta-top .meta-item svg {
    color: var(--color-accent-secondary);
  }

  .article-title {
    font-size: 2.5rem;
    margin: 0;
    color: var(--color-text);
    line-height: 1.3;
  }

  .article-meta-bottom {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 1.5rem;
    font-size: 0.9rem;
  }

  .article-meta-bottom .meta-item {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    background-color: var(--color-background-light);
    color: var(--color-text-secondary);
  }

  .article-meta-bottom .meta-item svg {
    color: var(--color-accent-secondary);
  }

  .article-meta-bottom .meta-item.category {
    background-color: var(--color-category-bg);
    color: var(--color-category-text);
  }

  .article-meta-bottom .meta-item.tag {
    background-color: var(--color-tag-bg);
    color: var(--color-tag-text);
  }

  .markdown-content h1,
  .markdown-content h2,
  .markdown-content h3,
  .markdown-content h4,
  .markdown-content h5,
  .markdown-content h6 {
    color: var(--color-text);
    margin-top: 2rem;
    margin-bottom: 1rem;
    line-height: 1.4;
  }

  .markdown-content h1 { font-size: 2em; }
  .markdown-content h2 { font-size: 1.75em; }
  .markdown-content h3 { font-size: 1.5em; }
  .markdown-content h4 { font-size: 1.25em; }
  .markdown-content h5 { font-size: 1em; }
  .markdown-content h6 { font-size: 0.875em; }

  .markdown-content p {
    color: var(--color-text-secondary);
    line-height: 1.8;
    margin-bottom: 1rem;
  }

  .markdown-content a {
    color: var(--color-accent);
    text-decoration: underline;
  }

  .markdown-content ul,
  .markdown-content ol {
    color: var(--color-text-secondary);
    margin-left: 1.5rem;
    margin-bottom: 1rem;
  }

  .markdown-content li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
  }

  .markdown-content blockquote {
    border-left: 4px solid var(--color-accent);
    padding-left: 1rem;
    margin: 1.5rem 0;
    color: var(--color-text-secondary);
    font-style: italic;
  }

  .markdown-content pre {
    background-color: var(--color-code-bg);
    color: var(--color-code-text);
    padding: 1rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 1.5rem 0;
  }

  .markdown-content code {
    font-family: 'Fira Code', 'Cascadia Code', monospace;
    background-color: var(--color-code-inline-bg);
    padding: 0.2em 0.4em;
    border-radius: 4px;
    color: var(--color-code-inline-text);
  }

  .markdown-content pre code {
    background-color: transparent;
    padding: 0;
    color: inherit;
  }

  .markdown-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
  }

  .markdown-content th,
  .markdown-content td {
    border: 1px solid var(--color-border);
    padding: 0.8rem;
    text-align: left;
    color: var(--color-text-secondary);
  }

  .markdown-content th {
    background-color: var(--color-table-header-bg);
    color: var(--color-text);
  }

  .markdown-content img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    margin: 1.5rem 0;
    display: block;
  }

  .markdown-content hr {
    border: none;
    border-top: 1px solid var(--color-border);
    margin: 2rem 0;
  }
</style>
