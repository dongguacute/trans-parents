---
/**
 * 優化的圖片組件，支援 WebP 格式和懶載入
 */
interface Props {
  src: string;
 alt: string;
  width?: number;
  height?: number;
  className?: string;
  lazy?: boolean;
  priority?: boolean;
}

const { 
  src, 
 alt, 
  width, 
  height, 
  className = '', 
  lazy = true,
 priority = false 
} = Astro.props;

// 決定是否使用 WebP 格式
const webpSrc = src.replace(/\.(jpg|jpeg|png)$/i, '.webp');
---

<div class={`optimized-image-container ${className}`} style={`width: ${width ? width + 'px' : 'auto'}; height: ${height ? height + 'px' : 'auto'}`}>
  <!-- 使用 picture 元素提供 WebP 備用選項 -->
  <picture>
    <source 
      srcset={webpSrc} 
      type="image/webp" 
    />
    <img
      src={src}
      alt={alt}
      width={width}
      height={height}
      loading={lazy ? 'lazy' : undefined}
      fetchpriority={priority ? 'high' : undefined}
      style="width: 100%; height: 100%; object-fit: cover;"
    />
  </picture>
</div>

<style>
  .optimized-image-container {
    position: relative;
    overflow: hidden;
  }
  
  .optimized-image-container img {
    transition: opacity 0.3s ease;
  }
</style>