---
// 性能監控組件 - 在開發模式下顯示性能指標
const isDev = import.meta.env.DEV;
---

{isDev && (
  <div id="perf-monitor" style="position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.8); color: #0f0; padding: 10px; border-radius: 8px; font-family: monospace; font-size: 12px; z-index: 9999;">
    <div id="perf-stats">載入中...</div>
  </div>
)}

<script is:inline>
  if (typeof window !== 'undefined' && window.performance) {
    window.addEventListener('load', () => {
      setTimeout(() => {
        const perfData = window.performance.timing;
        const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
        const connectTime = perfData.responseEnd - perfData.requestStart;
        const renderTime = perfData.domComplete - perfData.domLoading;
        
        const monitor = document.getElementById('perf-stats');
        if (monitor) {
          monitor.innerHTML = `
            ⚡ 頁面載入: ${pageLoadTime}ms<br>
            🔌 連接時間: ${connectTime}ms<br>
            🎨 渲染時間: ${renderTime}ms<br>
            📦 DOM 節點: ${document.getElementsByTagName('*').length}
          `;
        }

        // 使用 PerformanceObserver 監控資源
        if ('PerformanceObserver' in window) {
          const observer = new PerformanceObserver((list) => {
            for (const entry of list.getEntries()) {
              if (entry.duration > 100) {
                console.warn(`⚠️ 慢速資源: ${entry.name} (${Math.round(entry.duration)}ms)`);
              }
            }
          });
          observer.observe({ entryTypes: ['resource', 'navigation'] });
        }
      }, 0);
    });
  }
</script>